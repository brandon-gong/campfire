<!DOCTYPE html>    
<head>
    <title>Login</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../styles/index.css">
    <link rel="stylesheet" type="text/css" href="../styles/login.css">
</head>
<body>
	<div class="container">
		<!-- user input -->
				<img src="img/ember_text_dark.png" id="title-logo">
				<div id="error-message"></div>
				<div>
					<input type="text" id="email" placeholder="New account email">
				</div>
				<div>
					<input type="password" id="password" placeholder="Set password">
				</div>
		<img src="img/logo.png" width="40" style="margin-top: 30px">
        <button id = "create" onclick="attemptLogin"> Create </button>
	</div>
    <script type="module">
		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
		import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js';

		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries
		// Your web app's Firebase configuration
		const firebaseConfig = {
			apiKey: "<REDACTED>",
			authDomain: "ember-d1df3.firebaseapp.com",
			projectId: "ember-d1df3",
			storageBucket: "ember-d1df3.appspot.com",
			messagingSenderId: "769175463067",
			appId: "1:769175463067:web:ec900d28d33c3f62d6523e"
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);

		// Initialize Firebase Authentication and get a reference to the service
		const auth = getAuth(app);

      let emailElt = document.getElementById("email");
			let passElt = document.getElementById("password");
			let errorMsg = document.getElementById("error-message");
        function attemptCreate() {
			if (!emailElt.value) {
				// TODO add css class
				emailElt.classList.add("input-error");
				errorMsg.innerHTML = "Email field cannot be blank."
			} else if (!passElt.value) {
				passElt.classList.add("input-error");
				errorMsg.innerHTML = "Password field cannot be blank."
			} else {
				createUserWithEmailAndPassword(auth, emailElt.value, passElt.value)
					.then((userCredential) => {
						// Signed in
						let user = userCredential.user;
						window.location.href = "/index.html";
					})
					.catch((error) => {
						emailElt.classList.add("input-error");
						passElt.classList.add("input-error");
						errorMsg.innerHTML = error.message;
					});
			}
        }
				//document.getElementById("create-btn").addEventListener("click", attemptCreate);
		emailElt.addEventListener("keypress", (e) => {
			if (e.key === "Enter") {
				e.preventDefault();
				passElt.focus();
			}
		})
		passElt.addEventListener("keypress", (e) => {
			if (e.key === "Enter") {
				e.preventDefault();
				attemptCreate();
			}
		})

        document.getElementById("create").addEventListener("click", attemptCreate);
	</script>
</body>